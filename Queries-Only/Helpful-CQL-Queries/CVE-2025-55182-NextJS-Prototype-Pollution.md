# Next.js Server Action Prototype Pollution (CVE-2025-55182)

**Author:** Aaron Mog  
**Date:** 2025-12-03  
**Status:** Stable  
**Level:** Critical

## Description
Detects attempts to exploit CVE-2025-55182 (Next.js/React) via Server Actions. Target is identified by the 'Next-Action' header or 'RSC' markers, combined with JSON prototype pollution vectors in the body.

## References
- https://github.com/vercel/next.js/releases/tag/v16.0.7
- https://www.wiz.io/blog/critical-vulnerability-in-react-cve-2025-55182

## MITRE ATT&CK
- **Tactic:** Initial Access
- **Technique:** T1190 - Exploit Public-Facing Application

## CQL Query

```
// CVE-2025-55182: Next.js Server Action Prototype Pollution Detection
// Detects Server Action requests with prototype pollution payloads

// Base filter for web server logs (adjust based on your log source)
#event_simpleName=*
| in(field=[@metadata.datasource, event_simpleName], values=["apache", "nginx", "iis", "web", "http"])

// Filter for POST requests with Server Action indicators
| method=POST
| (http_headers=/Next-Action/i 
   OR http_headers=/RSC:\s*1/i
   OR headers=/Next-Action/i
   OR headers=/RSC:\s*1/i)

// Detect prototype pollution vectors in request body or URI
| (request_body=/__proto__/
   OR request_body=/\\u005f\\u005fproto\\u005f\\u005f/
   OR request_body=/constructor/
   OR request_body=/prototype/
   OR uri=/__proto__/
   OR uri=/\\u005f\\u005fproto\\u005f\\u005f/)

// Extract relevant fields
| select([c-ip, cs-uri, uri, src_ip, dst_ip, method, http_headers, headers, request_body, timestamp, ComputerName, aid])

// Group by source IP to identify multiple attempts
| groupBy([c-ip, cs-uri], function=[count(as=attempts), collect([timestamp], limit=10, as=attempt_times)])

// Sort by attempt count
| sort(field=attempts, order=desc, limit=1000)
```

## Alternative Query (Simplified)

```
// Simplified version for quick detection
method=POST 
(http_headers=/Next-Action/i OR http_headers=/RSC/i OR headers=/Next-Action/i OR headers=/RSC/i)
(request_body=/__proto__/ OR request_body=/\\u005f\\u005fproto\\u005f\\u005f/ OR request_body=/constructor/ OR request_body=/prototype/ OR uri=/__proto__/)
| select([c-ip, cs-uri, uri, src_ip, method, http_headers, request_body, timestamp])
| groupBy([c-ip], function=count(as=attempts))
| sort(attempts, order=desc)
```

## Query for Raw Text Logs

```
// For logs that aren't fully parsed
(Next-Action OR "RSC: 1" OR "RSC:1") 
("__proto__" OR "\\u005f\\u005fproto\\u005f\\u005f" OR "constructor" OR "prototype")
method=POST OR POST
| select([@rawstring, @timestamp, ComputerName])
```

## Field Mappings

Adjust these field names based on your log source:

| Sigma Field | Common CQL Fields |
|-------------|-------------------|
| `http_headers` | `http_headers`, `headers`, `cs-headers` |
| `cs-method` | `method`, `cs-method`, `http_method` |
| `request_body` | `request_body`, `cs-body`, `post_data` |
| `c-ip` | `c-ip`, `src_ip`, `clientip`, `remote_addr` |
| `cs-uri` | `cs-uri`, `uri`, `url`, `cs-uri-stem` |

## False Positives
- Security scanners (add scanner IP exclusions using `!in()` function)
- Development/testing environments

## Example Exclusion for Known Scanners

```
// Add this line after the base filters to exclude known security scanners
| !in(field=c-ip, values=["10.0.0.100", "192.168.1.50"])
```

## Alert/Dashboard Integration

To create an alert, add this at the end:
```
| attempts > 1  // Trigger on multiple attempts
| select([c-ip, attempts, attempt_times, cs-uri])
```

## Notes
- Adjust the initial event filter based on your web server log source (Apache, Nginx, IIS, etc.)
- The `http_headers` field might be named differently in your environment
- Consider adding additional context fields specific to your environment
- For CrowdStrike Falcon LogScale, you may need to adjust field names based on your parser configuration
